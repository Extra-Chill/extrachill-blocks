(()=>{"use strict";const e=window.React,t=window.wp.blocks,r=window.wp.blockEditor,a=window.wp.i18n,l=window.wp.element,i=window.wp.components,n=window.wp.data,s=JSON.parse('{"UU":"extrachill-blocks/ai-adventure-step"}');(0,t.registerBlockType)(s.UU,{edit:({attributes:t,setAttributes:s,clientId:o})=>{const{stepPrompt:c,stepId:d,triggers:p}=t,h=(0,n.useSelect)(e=>{const{getBlocks:t}=e("core/block-editor"),r=t(),l=[];let i=-1;const n=r.find(e=>"extrachill-blocks/ai-adventure"===e.name);n&&(n.innerBlocks.forEach((e,t)=>{e.innerBlocks.some(e=>e.clientId===o)&&(i=t)}),n.innerBlocks.forEach((e,t)=>{if(t<=i)return;if("extrachill-blocks/ai-adventure-path"!==e.name)return;const r=e.innerBlocks[0];if(r&&"extrachill-blocks/ai-adventure-step"===r.name){const a=e.attributes.label||`Path ${t+1}`,i="Step 1",n=r.attributes.stepId||r.clientId;l.push({value:n,label:`${a} â†’ ${i}`})}}));const s=[{value:"",label:(0,a.__)("Select destination...","extrachill-blocks")},{value:"end_game",label:(0,a.__)("ðŸ End Game","extrachill-blocks")}];return l.length>0&&s.push(...l),s},[o]);(0,l.useEffect)(()=>{d||s({stepId:o})},[o]);const g=(e,t,r)=>{const a=[...p];a[t][r]=e,s({triggers:a})};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(r.InspectorControls,null,(0,e.createElement)(i.PanelBody,{title:(0,a.__)("Story Triggers","extrachill-blocks")},(0,e.createElement)("p",{className:"components-base-control__help"},(0,a.__)('Define semantic conditions that advance the story. Use descriptive phrases like "Player opens the chest" or "Player talks to the wizard".',"extrachill-blocks")),p.map((t,r)=>(0,e.createElement)("div",{key:r,className:"trigger-item",style:{marginBottom:"20px",padding:"15px",border:"1px solid #ddd",borderRadius:"4px"}},(0,e.createElement)(i.TextareaControl,{label:(0,a.__)("Trigger Condition","extrachill-blocks"),value:t.triggerPhrase,onChange:e=>g(e,r,"triggerPhrase"),placeholder:"e.g., Player decides to enter the cave",help:(0,a.__)("Describe the player action or decision that should trigger this path.","extrachill-blocks"),rows:3}),(0,e.createElement)(i.SelectControl,{label:(0,a.__)("Destination","extrachill-blocks"),value:t.destinationStep,onChange:e=>g(e,r,"destinationStep"),options:h,help:(0,a.__)("Where should the story go when this trigger is activated?","extrachill-blocks")}),(0,e.createElement)(i.Button,{isLink:!0,isDestructive:!0,onClick:()=>(e=>{const t=[...p];t.splice(e,1),s({triggers:t})})(r)},(0,a.__)("Remove Trigger","extrachill-blocks")))),(0,e.createElement)(i.Button,{variant:"primary",onClick:()=>{const e=[...p,{triggerPhrase:"",destinationStep:""}];s({triggers:e})}},(0,a.__)("Add Story Trigger","extrachill-blocks")))),(0,e.createElement)("div",{...(0,r.useBlockProps)()},(0,e.createElement)(r.RichText,{tagName:"p",onChange:e=>s({stepPrompt:e}),value:c,placeholder:(0,a.__)("Step Action: What is happening at this moment in the story?","extrachill-blocks")})))},save:({attributes:t})=>{const{stepPrompt:a,label:l,stepId:i,triggers:n}=t,s=r.useBlockProps.save({"data-step-id":i,"data-triggers":JSON.stringify(n||[])});return(0,e.createElement)("div",{...s},l&&(0,e.createElement)(r.RichText.Content,{tagName:"h4",value:l}),a&&(0,e.createElement)(r.RichText.Content,{tagName:"p",value:a,className:"ai-adventure-step-prompt"}))}})})();